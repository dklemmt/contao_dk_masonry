<script type="text/javascript">
/* <![CDATA[ */
(function($) {
	var $masonry = $('#masonry_<?php echo $this->id; ?>');
	$(document).ready(function() {
<?php
	if ($this->gutterClass) {
		echo "\t\t" . '$masonry.prepend("<div class=\'' . $this->gutterClass . '\'></div>");' . "\n";
	}
	if ($this->columnWidthClass) {
		echo "\t\t" . '$masonry.prepend("<div class=\'' . $this->columnWidthClass . '\'></div>");' . "\n";
	}		
	if ($this->isFitWidth) {
		echo "\t\t" . '$masonry.css("margin", "0 auto");' . "\n";
	}
	switch ($this->type) {
		case 'masonry_gallery':
?>
		$masonry.addClass("loading");
		$("#masonry_<?php echo $this->id; ?> .masonry_gallery").addClass("loading").find("img").css({ opacity: 0, visibility: "hidden" });
		initMasonry();
		$masonry.imagesLoaded()
			.progress(function(instance, image) {
				$(image.img).css({ visibility: "visible" }).animate({ opacity: 1 }, 400).closest('.loading').removeClass('loading');
				$masonry.masonry();
			})
			.always(function() {
				$masonry.removeClass("loading");
			});
	});
	function initMasonry() {
	    $masonry.masonry({
<?php
			echo 'itemSelector: ".masonry_gallery"';
			break;

		case 'masonry_start':
?>
		$masonry.children().addClass("masonry_item");
		initMasonry();
	});
	function initMasonry() {
	    $masonry.masonry({
<?php
			echo 'itemSelector: ".masonry_item"';
			break;
	}

	if ($this->columnWidth) {		
		echo ', ' . $this->columnWidth;
	}
	if ($this->gutter) {
		echo ', ' . $this->gutter;
	}
	if ($this->isFitWidth) {
		echo ', ' . $this->isFitWidth;
	}
	if ($this->isOriginLeft) {
		echo ', ' . $this->isOriginLeft;
	}
	if ($this->isOriginTop) {
		echo ', ' . $this->isOriginTop;
	}
	if ($this->isResizeBound) {
		echo ', ' . $this->isResizeBound;
	}
	if ($this->transitionDuration) {
		echo ', ' . $this->transitionDuration;
	}
?>
		});
	};
})(jQuery);
/* ]]> */
</script>
